<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.training.ncr.mapper.user.UserExplanationMapper">
    <!--첫 사용자 훈련 진입 시 db insert-->
    <insert id="insertUserTrainExamStat">
       INSERT INTO
            "TN_TRAIN_EXAMSTAT"
       (
           "TR_USER_ID",
           "TR_USER_GRP",
           "TR_NUM",
           "TR_EXAM_GRPID",
           "START_TIME"
       )
       VALUES
       (
           #{tr_user_id},
           #{tr_user_grp},
           #{tr_num},
           #{tr_exam_grpid},
           NOW()
       )
    </insert>

    <!--뒤늦은 사용자 훈련 진입 시 db insert-->
    <insert id="laterInsertUserTrainExamStat">
        INSERT INTO
        "TN_TRAIN_EXAMSTAT"
        (
        "TR_USER_ID",
        "TR_USER_GRP",
        "TR_NUM",
        "TR_EXAM_GRPID",
        "START_TIME"
        )
        VALUES
        (
        #{tr_user_id},
        #{tr_user_grp},
        #{tr_num},
        #{tr_exam_grpid},
        To_TIMESTAMP(#{start_time},'YYYY-MM-DD HH24:mi:ss.SSSSSX')
        )
    </insert>
    <!--훈련자 풀이현황에 내가 있는지 확인하기-->
    <select id="selectByUserID" resultType="ExamStatVO">
        SELECT
            "STAT_ID"
        FROM
            "TN_TRAIN_EXAMSTAT"
        WHERE
            "TR_USER_ID" = #{tr_user_id}
    </select>

    <!--나의 id로 팀코드 구하기-->
    <select id="getTeamcodeByUserid" resultType="String">
        SELECT
            "TEAM_CD"
        FROM
            "TN_USER"
        WHERE
            "TR_USER_ID" = #{id}
    </select>

    <!--첫 훈련팀별 풀이현황 db insert-->
    <insert id="insertExamstatTeam">
        INSERT INTO
            "TN_TRAIN_EXAMSTAT_TEAM"
        (
            "TR_USER_GRP",
            "TEAM_CD",
            "TR_NUM",
            "TR_EXAM_GRPID",
            "START_TIME"
        )
        VALUES
        (
            #{tr_user_grp},
            #{team_cd},
            #{tr_num},
            #{tr_exam_grpid},
            NOW()
        )
    </insert>

    <!--훈련팀별 풀이현황에 내가 있는지 확인하기-->
    <select id="selectByTeamcd" resultType="ExamStatTeamVO">
        SELECT
            "STAT_ID"
        FROM
            "TN_TRAIN_EXAMSTAT_TEAM"
        WHERE
            "TEAM_CD" = #{team_cd}
    </select>

    <!--첫 풀이 훈련자별 상세정보 db insert-->
    <insert id="insertTrainExamResult">
        INSERT INTO "TN_TRAIN_EXAMRESULT"
        (
        "TR_USER_ID",
        "TR_NUM",
        "TR_EXAM_GRPID",
        "TR_EXAM_ID"
        )
        VALUES
        (
        #{tr_user_id},
        #{tr_num},
        #{tr_exam_grpid},
        #{tr_exam_id}
        )
    </insert>

    <!--첫 풀이 훈련자별 상세정보 db insert를 하기위한 check 팀별 db가 있는지-->
    <select id="checkExamResultVO" resultType="ExamResultVO">
        SELECT
        "STAT_ID"
        FROM
        "TN_TRAIN_EXAMRESULT"
        WHERE
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
        "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--첫 풀이 훈련팀별 상세정보 db insert를 하기위한 check 팀별 db가 있는지-->
    <select id="checkExamResultTeamVO" resultType="ExamResultTeamVO">
        SELECT
            "STAT_ID"
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TEAM_CD" = #{team_cd} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
        "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--첫 풀이 훈련팀별 상세정보 db insert-->
    <insert id="insertTrainExamResultTeam">
        INSERT INTO "TN_TRAIN_EXAMRESULT_TEAM"
        (
        "TR_USER_GRP",
        "TEAM_CD",
        "TR_NUM",
        "TR_EXAM_GRPID",
        "TR_EXAM_ID"
        )
        VALUES
        (
        #{tr_user_grp},
        #{team_cd},
        #{tr_num},
        #{tr_exam_grpid},
        #{tr_exam_id}
        )
    </insert>

    <!--나의 아이디로 나의 정보 가져오기-->
    <select id="getMyInfoByUserId" resultType="UserVO">
        SELECT
            *
        FROM
            "TN_USER"
        WHERE
            "TR_USER_ID" = #{tr_user_id}
    </select>

    <!--해당하는 문제 답안,배점 가져오기-->
    <select id="getExamAnsAndPoint" resultType="ExamVO">
        SELECT
        "TR_EXAM_ANS",
        "TR_EXAM_POINT"
        FROM   "TN_TRAIN_EXAM"
        WHERE "TR_EXAM_ID" = #{tr_exam_id} AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!-- 문제 그룹정보 가져오기-->
    <select id="getExamGrpVO" resultType="ExamGrpVO">
        SELECT
            *
        FROM
            "TN_TRAIN_EXAMGRP"
        WHERE
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--정답 입력횟수 남아있는지 가져오기-->
    <select id="checkCntTryAns" resultType="ExamResultTeamVO">
        SELECT
            "CNT_TRY_ANS"
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--훈련자별 풀이 상세 정보 있는지 확인하기-->
    <select id="examResultCheck" resultType="ExamResultVO">
        SELECT
            "STAT_ID"
        FROM "TN_TRAIN_EXAMRESULT"
        WHERE
            "TR_USER_ID" = #{tr_user_id}
        AND    "TR_NUM" = #{tr_num}
        AND    "TR_EXAM_GRPID" = #{tr_exam_grpid}
        AND    "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--해당 힌트 가져오기-->
    <select id="getHint" resultType="ExamHintVO">
        SELECT
            *
        FROM
            "TN_TRAIN_EXAMHINT"
        WHERE
            "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
            "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--힌트 사용여부 check-->
    <select id="checkHintUsing" resultType="int">
        SELECT
            "HINT_USE"
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
        "TR_USER_GRP" = #{tr_user_grp}
        AND "TEAM_CD" = #{team_cd}
        AND "TR_NUM" = #{tr_num}
        AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
        AND "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--힌트 첫 사용 update (훈련팀별)-->
    <update id="firstHintUsingTeam">
        UPDATE "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "HINT_USE" = 1
        WHERE
        "TR_USER_GRP" = #{tr_user_grp}
        AND "TEAM_CD" = #{team_cd}
        AND "TR_NUM" = #{tr_num}
        AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
        AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--힌트 첫 사용 update (훈련자별)-->
    <update id="firstHintUsingUser">
        UPDATE "TN_TRAIN_EXAMRESULT"
        SET
            "HINT_USE" = 1
        WHERE
            "TR_USER_ID" = #{tr_user_id}
        AND    "TR_NUM" = #{tr_num}
        AND    "TR_EXAM_GRPID" = #{tr_exam_grpid}
        AND    "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--문제그룹id로 정보 가져오기 (2차 풀이여부, 2차 풀이 감점, 힌트감점)-->
    <select id="getExamGrpInfo" resultType="ExamGrpVO">
        SELECT
            *
        FROM
            "TN_TRAIN_EXAMGRP"
        WHERE
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>
    <!--문제id로 정보 가져오기(정답, 배점)-->
    <select id="getExamInfo" resultType="ExamVO">
        SELECT
            "TR_EXAM_ANS",
            "TR_EXAM_POINT"
        FROM
            "TN_TRAIN_EXAM"
        WHERE
            "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--정답 입력 횟수 남아있는지 check-->
    <select id="checkTryAns" resultType="int">
        SELECT
            "CNT_TRY_ANS"
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
            "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--2차 풀이 활성화인데 1차에서 오답일때(객관식,주관식)-->
    <update id="firstAnsNotAnsMulti">
        UPDATE
            "TN_TRAIN_EXAMRESULT_TEAM"
        SET
          "ANSWER_USER_ID" = #{answer_user_id},
          "INPUT_ANSWER" = #{input_answer},
          "CNT_TRY_ANS" = 1
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--2차 풀이 활성화인데 1차에서 정답일때(객관식,주관식)-->
    <update id="firstAnsEqualsAnsMulti">
        UPDATE
            "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "ANSWER_USER_ID" = #{answer_user_id},
            "INPUT_ANSWER" = #{input_answer},
            "RESULT_SCORE" = "RESULT_SCORE" + #{point},
            "CNT_TRY_ANS" = 2,
            "CORRECT_ANSWER" = 1
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--2차 풀이 활성화인데 1차에서 정답일때(객관식,주관식) and 힌트사용-->
    <update id="firstAnsEqualsAnsMultiAndHintUse">
        UPDATE
        "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "ANSWER_USER_ID" = #{answer_user_id},
            "INPUT_ANSWER" = #{input_answer},
            "RESULT_SCORE" = "RESULT_SCORE" + #{point} - #{hint},
            "CNT_TRY_ANS" = 2,
            "CORRECT_ANSWER" = 1
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--2차 풀이에서 정답일때(객관식,주관식)-->
    <update id="secondAnsEqualsAnsMulti">
        UPDATE
            "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "ANSWER_USER_ID" = #{answer_user_id},
            "INPUT_ANSWER" = #{input_answer},
            "RESULT_SCORE" = "RESULT_SCORE" - #{result_score} + #{point},
            "CNT_TRY_ANS" = 2,
            "CORRECT_ANSWER" = 1
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--오답 점수 update-->
    <update id="wrongScoreUpdate">
        UPDATE
            "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "WRONG_SCORE" = #{wrong_score}
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--2차 풀이에서 정답일때(객관식,주관식) and 힌트사용 -->
    <update id="secondAnsEqualsAnsMultiAndHintUser">
        UPDATE
        "TN_TRAIN_EXAMRESULT_TEAM"
        SET
        "ANSWER_USER_ID" = #{answer_user_id},
        "INPUT_ANSWER" = #{input_answer},
        "RESULT_SCORE" = "RESULT_SCORE" - #{result_score} + #{point} - #{hint},
        "CNT_TRY_ANS" = 2,
        "CORRECT_ANSWER" = 1
        WHERE
        "TR_USER_GRP" = #{tr_user_grp}
        AND "TEAM_CD" = #{team_cd}
        AND "TR_NUM" = #{tr_num}
        AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
        AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--2차 풀이에서 오답일때(객관식,주관식)-->
    <update id="secondAnsNotAnsMulti">
        UPDATE
            "TN_TRAIN_EXAMRESULT_TEAM"
        SET
            "ANSWER_USER_ID" = #{answer_user_id},
            "INPUT_ANSWER" = #{input_answer},
            "RESULT_SCORE" = 0,
            "CNT_TRY_ANS" = 2
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--풀이 중인 훈련자 팀 가져오기-->
    <select id="getExamResultTeamInfo" resultType="ExamResultTeamVO">
        SELECT
            *
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--정답일때 획득한 점수 가져오기(훈련팀별 점수) 훈련자에 뿌려주기 위함-->
    <select id="getResultScoreForUser" resultType="int">
        SELECT
            "RESULT_SCORE"
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp}
            AND "TEAM_CD" = #{team_cd}
            AND "TR_NUM" = #{tr_num}
            AND "TR_EXAM_GRPID" = #{tr_exam_grpid}
            AND "TR_EXAM_ID" = #{tr_exam_id}
    </select>

    <!--훈련자 풀이 상세 정보(정답)-->
    <update id="examResultAnsEqualsAns">
        UPDATE "TN_TRAIN_EXAMRESULT"
        SET
            "INPUT_ANSWER" = #{input_answer},
            "RESULT_SCORE" = #{result_score},
            "CNT_TRY_ANS" = "CNT_TRY_ANS" + 1,
            "CORRECT_ANSWER" = 1
        WHERE
            "TR_USER_ID" = #{tr_user_id} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
            "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--훈련자 풀이 상세 정보(오답)-->
    <update id="examResultAnsNotAns">
        UPDATE "TN_TRAIN_EXAMRESULT"
        SET
        "INPUT_ANSWER" = #{input_answer},
        "CNT_TRY_ANS" = "CNT_TRY_ANS" + 1
        WHERE
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid} AND
        "TR_EXAM_ID" = #{tr_exam_id}
    </update>

    <!--뒤늦게 시작한 훈련자의 훈련팀 시작 시간 가져오기-->
    <select id="laterUserGetTeamStartTime" resultType="String">
        SELECT
            "START_TIME"
        FROM
            "TN_TRAIN_EXAMSTAT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--현재 훈련 진행중인 시간 가져오기-->
    <select id="startTrainingGetTime" resultType="String">
        SELECT
            "START_TIME"
        FROM
            "TN_TRAIN_EXAMSTAT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--훈련팀별 풀이 현황정보 정답 수 update-->
    <select id="countAnsExamResultTeam" resultType="int">
        SELECT
            count("STAT_ID")
        FROM
            "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "RESULT_SCORE" > 0 AND
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--풀이 개수, 정답점수, 오답점수, 힌트점수 가져오기-->
    <select id="getTotalStatus" resultType="map">
        SELECT
        count("CNT_TRY_ANS") as explanationCount,
            (SELECT
                "TR_EXAM_COUNT"
            FROM
                "TN_TRAIN_EXAMGRP"
            WHERE
                "TR_EXAM_GRPID" = #{tr_exam_grpid}) as maxExplanationCount,
            (SELECT
                sum("RESULT_SCORE")
            FROM
                "TN_TRAIN_EXAMRESULT_TEAM"
            WHERE
                "TR_USER_GRP" = #{tr_user_grp} and
                "TEAM_CD" = #{team_cd} and
                "TR_EXAM_GRPID" = #{tr_exam_grpid} and
                "RESULT_SCORE" >= 0) as resultScore,
            (SELECT
                sum("WRONG_SCORE")
            FROM
                "TN_TRAIN_EXAMRESULT_TEAM"
            WHERE
                "TR_USER_GRP" = #{tr_user_grp} and
                "TEAM_CD" = #{team_cd} and
                "TR_EXAM_GRPID" = #{tr_exam_grpid}) as wrongScore,
            (SELECT
                count("STAT_ID")*10
            FROM
                "TN_TRAIN_EXAMRESULT_TEAM"
            WHERE
                "TR_USER_GRP" = #{tr_user_grp} and
                "TEAM_CD" = #{team_cd} and
                "TR_EXAM_GRPID" = #{tr_exam_grpid} and
                "HINT_USE"=1) as hintScore
        FROM
             "TN_TRAIN_EXAMRESULT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} and
            "TEAM_CD" = #{team_cd} and
            "TR_EXAM_GRPID" = #{tr_exam_grpid} and
            "CNT_TRY_ANS" = 2
    </select>

    <!-- 정답 수 UPDATE (훈련팀별) -->
    <update id="updateCntCorrectAnsTeam">
        UPDATE
            "TN_TRAIN_EXAMSTAT_TEAM"
        SET
            "CNT_CORRECT_ANS" = "CNT_CORRECT_ANS"+1
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--오답 수 UPDATE (훈련팀별)-->
    <update id="updateCntFalseAnsTeam">
        UPDATE
        "TN_TRAIN_EXAMSTAT_TEAM"
        SET
        "CNT_FALSE_ANS" = "CNT_FALSE_ANS"+1
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TEAM_CD" = #{team_cd} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--총 점수 UPDATE (훈련팀별)-->
    <update id="updateResultSumTeam">
        UPDATE
            "TN_TRAIN_EXAMSTAT_TEAM"
        SET
            "RESULT_SUM" = (
                SELECT
                    sum("RESULT_SCORE")
                FROM
                    "TN_TRAIN_EXAMRESULT_TEAM"
                WHERE
                    "TR_USER_GRP" = #{tr_user_grp} AND
                    "TEAM_CD" = #{team_cd} AND
                    "TR_NUM" = #{tr_num} AND
                    "TR_EXAM_GRPID" =  #{tr_exam_grpid})
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!-- 정답 수 UPDATE (훈련자별) -->
    <update id="updateCntCorrectAnsUser">
        UPDATE
        "TN_TRAIN_EXAMSTAT"
        SET
        "CNT_CORRECT_ANS" = "CNT_CORRECT_ANS"+1
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--오답 수 UPDATE (훈련자별)-->
    <update id="updateCntFalseAnsUser">
        UPDATE
        "TN_TRAIN_EXAMSTAT"
        SET
        "CNT_FALSE_ANS" = "CNT_FALSE_ANS"+1
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--총 점수 UPDATE (훈련자별)-->
    <update id="updateResultSumUser">
        UPDATE
        "TN_TRAIN_EXAMSTAT"
        SET
        "RESULT_SUM" = (
            SELECT
            sum("RESULT_SCORE")
            FROM
            "TN_TRAIN_EXAMRESULT"
            WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TR_USER_ID" = #{tr_user_id} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" =  #{tr_exam_grpid})
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--제출하기 이벤트 (훈련팀별)-->
    <update id="updateSubmitTeam">
        UPDATE
        "TN_TRAIN_EXAMSTAT_TEAM"
        SET
        "SUBMIT_ANSWER" = 1,
        "END_TIME" = NOW()
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TEAM_CD" = #{team_cd} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--제출하기 이벤트 (훈련자별)-->
    <update id="updateSubmitUser">
        UPDATE
        "TN_TRAIN_EXAMSTAT"
        SET
        "SUBMIT_ANSWER" = 1,
        "END_TIME" = NOW()
        WHERE
        "TR_USER_GRP" = #{tr_user_grp} AND
        "TR_USER_ID" = #{tr_user_id} AND
        "TR_NUM" = #{tr_num} AND
        "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </update>

    <!--제출여부 check-->
    <select id="checkSubmitTeam" resultType="int">
        SELECT
            "SUBMIT_ANSWER"
        FROM
            "TN_TRAIN_EXAMSTAT_TEAM"
        WHERE
            "TR_USER_GRP" = #{tr_user_grp} AND
            "TEAM_CD" = #{team_cd} AND
            "TR_NUM" = #{tr_num} AND
            "TR_EXAM_GRPID" = #{tr_exam_grpid}
    </select>

    <!--전술단계 id 가져오기-->
    <select id="getMaTacticsId" resultType="map">
        SELECT
            "MA_TACTICS_ID"
        FROM
            "TC_MITERATTACK_TACTICS"
    </select>
</mapper>