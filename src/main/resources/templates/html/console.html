<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>VMware Web Console Viewer</title>
    <link rel="stylesheet" type="text/css" href="" />
    <script src="/js/jquery-3.6.4.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/wmks.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/wmks-all.css" />
  </head>
  <body>
    <div
      id="wmksContainer"
      style="position: absolute; width: 100%; height: 100%"
    ></div>
    <script>
      let vmId = "";
      function getVm() {
        $.ajax({
          async: false,
          url: "https://192.168.32.22:8443/get_vm_id",
          type: "GET",
          dataType: "text",
          success: function (response) {
            console.log(response);
            vmId = response;
          },
        });
        return vmId;
      }
      var host = "192.168.32.101";
      var username = "administrator@vsphere.local";
      var password = "qweR123#001";
      var target = getVm();
      $.ajax({
        url: "https://192.168.32.22:5000/vmware_console_url",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({
          host: host,
          username: username,
          password: password,
          target: target,
        }),
        success: function (result) {
          console.log("result : ", result);
          var url = result.url;
          var wmks = WMKS.createWMKS("wmksContainer", {}).register(
            WMKS.CONST.Events.CONNECTION_STATE_CHANGE,
            function (event, data) {
              if (data.state == WMKS.CONST.ConnectionState.CONNECTED) {
                console.log("연결 상태 변경 : 연결됨");
              }
            }
          );
          wmks.connect(url);
        },
        error: function (xhr, status, error) {
          alert("Error: " + error);
        },
      });
    </script>
  </body>
</html>
