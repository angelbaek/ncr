<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>VMware Web Console Viewer</title>
    <link rel="stylesheet" type="text/css" href="css/wmks-all.css" />
    <script
      type="text/javascript"
      src="http://code.jquery.com/jquery-1.8.3.min.js"
    ></script>
    <script
      type="text/javascript"
      src="http://code.jquery.com/ui/1.8.16/jquery-ui.min.js"
    ></script>
    <script type="text/javascript" src="wmks.min.js"></script>
  </head>
  <body>
    <div>
      <button id="get-url-btn">request</button>
    </div>
    <div
      id="wmksContainer"
      style="position: absolute; width: 100%; height: 100%"
    ></div>
    <script>
      $(document).ready(function () {
        $("#get-url-btn").click(function () {
          var host = "192.168.32.101";
          var username = "administrator@vsphere.local";
          var password = "qweR123#001";
          var target = "Windows 10_VictimTemp5";

          $.ajax({
            url: "http://192.168.32.44:5000/vmware_console_url",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
              host: host,
              username: username,
              password: password,
              target: target,
            }),
            success: function (result) {
              console.log("result : ", result);

              var wmks = WMKS.createWMKS("wmksContainer", {}).register(
                WMKS.CONST.Events.CONNECTION_STATE_CHANGE,
                function (event, data) {
                  if (data.state == WMKS.CONST.ConnectionState.CONNECTED) {
                    console.log("connection state change : connected");
                  }
                }
              );
              wmks.connect(result.url);
            },
            error: function (xhr, status, error) {
              alert("Error: " + error);
            },
          });
        });
      });
    </script>
  </body>
</html>
